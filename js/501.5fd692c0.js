"use strict";(self["webpackChunktwitter_front_2020"]=self["webpackChunktwitter_front_2020"]||[]).push([[501],{6632:function(e,t,s){s.d(t,{Z:function(){return h}});s(6699);var r=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.loadMore,expression:"loadMore"}],attrs:{"infinite-scroll-disabled":"busy"}},e._l(e.tweets,(function(r){return t("div",{key:r.id,staticClass:"tweet-wrapper"},[t("div",{staticClass:"tweet-wrapper-left"},[t("router-link",{staticClass:"link",attrs:{to:"/users/"+r.User.id}},[t("img",{attrs:{src:r.User.avatar,alt:""}})])],1),t("div",{staticClass:"tweet-wrapper-right"},[t("div",{staticClass:"tweet-info"},[t("router-link",{staticClass:"link",attrs:{to:"/users/"+r.User.id}},[t("div",{staticClass:"tweet-info-name"},[e._v(e._s(r.User.name))])]),t("router-link",{staticClass:"link",attrs:{to:"/users/"+r.User.id}},[t("div",{staticClass:"tweet-info-account"},[e._v(" @"+e._s(r.User.account))])]),t("div",{staticClass:"tweet-info-data"},[e._v("・"+e._s(e._f("fromNow")(r.createdAt)))])],1),t("router-link",{staticClass:"link",attrs:{to:"/tweets/"+r.id}},[t("div",{staticClass:"tweet-description"},[e._v(" "+e._s(r.description)+" ")])]),t("div",{staticClass:"tweet-interaction"},[t("div",[t("img",{attrs:{src:s(3009),alt:"",type:"button","data-bs-toggle":"modal","data-bs-target":"#modal"+r.id}}),t("p",[e._v(e._s(r.repliesLength))])]),e.currentUser.userLikesId.includes(r.id)?t("div",[t("img",{attrs:{src:s(5179),type:"button",alt:""},on:{click:function(t){return e.unlikeTweet(r.id)}}}),t("p",[e._v(e._s(r.likesLength))])]):t("div",[t("img",{attrs:{src:s(5813),type:"button",alt:""},on:{click:function(t){return e.likeTweet(r.id)}}}),t("p",[e._v(e._s(r.likesLength))])])])],1),t("ModalTweetReply",{attrs:{tweet:r,currentUser:e.currentUser},on:{"after-post-tweet-reply":e.afterPostTweetReply}})],1)})),0)},i=[],n=s(3459),a=s(2090),o=s(3822),c=s(3729),l={components:{ModalTweetReply:a.Z},props:{propsTweets:{type:Array,required:!0},loadMoreTrigger:{type:String},loadToEnd:{type:Boolean}},data(){return{tweets:[],busy:!1}},methods:{afterPostTweetReply(e){const{TweetId:t}=e;this.tweets.forEach((e=>{e.id===Number(t)&&(e.repliesLength+=1)})),"user"===this.$router.history.current.name&&Number(this.$router.history.current.params.id)===this.currentUser.id&&this.$emit("after-post-tweet-reply",{...e})},async likeTweet(e){try{this.isProcessing=!0;let t=0;const{data:s}=await c.Z.likeTweet({tweetId:e});if("success"===s.status&&(this.currentUser.userLikesId.push(e),this.tweets.forEach((s=>{s.id===e&&(s.likesLength+=1,t=s.likesLength)}))),"user"===this.$route.name&&Number(this.$route.params.id)===this.currentUser.id){let s={};this.tweets.forEach((t=>{t.id===e&&(s={...t})})),this.$emit("after-like-tweet",{newLikedTweet:{...s},likesLength:t,from:"TweetsSection"})}this.isProcessing=!1}catch(t){this.isProcessing=!1,console.warn(t)}},async unlikeTweet(e){try{this.isProcessing=!0;let t=0;const{data:s}=await c.Z.unlikeTweet({tweetId:e});"success"===s.status&&(this.currentUser.userLikesId=this.currentUser.userLikesId.map((t=>{if(t!==e)return t})),this.tweets.forEach((s=>{s.id===e&&(s.likesLength-=1,t=s.likesLength)}))),"user"===this.$route.name&&Number(this.$route.params.id)===this.currentUser.id&&this.$emit("after-unlike-tweet",{unlikeTweetId:e,likesLength:t,from:"TweetsSection"}),this.isProcessing=!1}catch(t){this.isProcessing=!1,console.warn(t)}},loadMore(){"tweets"===this.loadMoreTrigger&&!0!==this.loadToEnd&&(this.busy=!0,this.$emit("load-more",{from:"tweetsSection"}),setTimeout((()=>{this.busy=!1}),1500))}},computed:{...(0,o.rn)(["currentUser"])},watch:{propsTweets(e){this.tweets=e}},mixins:[n.q]},d=l,u=s(1001),w=(0,u.Z)(d,r,i,!1,null,null,null),h=w.exports},1829:function(e,t,s){s.r(t),s.d(t,{default:function(){return k}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container"},[t("div",{staticClass:"left-container"},[t("Navbar",{staticClass:"Navbar",attrs:{currentUser:e.currentUser}})],1),t("div",{staticClass:"middle-container"},[t("h1",[e._v("首頁")]),t("NewTweet",{attrs:{currentUser:e.currentUser,isProcessing:e.isProcessing},on:{"after-create-tweet":e.afterCreateTweet}}),t("TweetsSection",{attrs:{propsTweets:e.tweets,loadMoreTrigger:e.loadMoreTrigger,loadToEnd:e.loadToEnd},on:{"load-more":e.loadMore}}),t("ModalNewTweet",{attrs:{currentUser:e.currentUser},on:{"after-post-new-tweet":e.afterPostNewTweet}})],1),t("div",{staticClass:"right-container"},[t("FollowingsBar",{staticClass:"FollowingsBar",attrs:{currentUser:e.currentUser}})],1)])},i=[],n=(s(1703),s(2474)),a=s(4904),o=s(6632),c=function(){var e=this,t=e._self._c;return t("div",{staticClass:"new-tweet-wrapper"},[t("div",{staticClass:"new-tweet-wrapper-left"},[t("router-link",{staticClass:"link",attrs:{to:"/users/"+e.currentUser.id}},[t("img",{attrs:{src:e.currentUser.avatar,alt:""}})])],1),t("form",{staticClass:"new-tweet-wrapper-right",on:{submit:function(t){return t.preventDefault(),t.stopPropagation(),e.handleSubmit.apply(null,arguments)}}},[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.newTweetDescription,expression:"newTweetDescription"}],attrs:{cols:"30",rows:"5",maxlength:"140",placeholder:"有什麼新鮮事？",name:"newTweetDescription",required:""},domProps:{value:e.newTweetDescription},on:{keyup:e.words_deal,input:function(t){t.target.composing||(e.newTweetDescription=t.target.value)}}}),t("div",{staticClass:"textContent-span-wrapper"},[t("span",{staticClass:"textContent-span textContent-span-warning textContent-span-hidden"},[e._v("字數已達上限!")]),t("span",{staticClass:"textContent-span textContent-span-hidden"}),t("button",{staticClass:"btn btn-orange btn-new-tweet",attrs:{type:"submit",disabled:e.isProcessing}},[e._v("推文")])])])])},l=[],d=s(6163),u={props:{isProcessing:{type:Boolean,required:!0},currentUser:{type:Object,required:!0}},data(){return{newTweetDescription:""}},methods:{handleSubmit(e){this.newTweetDescription.trim()?(this.newTweetDescription.length>140&&(this.newTweetDescription=this.newTweetDescription.slice(0,140)),this.$emit("after-create-tweet",{UserId:this.currentUser.id,description:this.newTweetDescription}),this.newTweetDescription="",e.target.children[1].children[0].classList.add("textContent-span-hidden"),e.target.children[1].children[1].classList.add("textContent-span-hidden")):d.F.fire({icon:"warning",title:"推文內容不可為空白"})},words_deal(e){const t=e.target.attributes.maxlength.value,s=e.target.value.length;t-s<=20?(e.target.parentElement.children[1].children[1].classList.remove("textContent-span-hidden"),e.target.parentElement.children[1].children[1].textContent=`${s}/${t}`,s>=t?e.target.parentElement.children[1].children[0].classList.remove("textContent-span-hidden"):e.target.parentElement.children[1].children[0].classList.add("textContent-span-hidden")):(e.target.parentElement.children[1].children[0].classList.add("textContent-span-hidden"),e.target.parentElement.children[1].children[1].classList.add("textContent-span-hidden"))}}},w=u,h=s(1001),p=(0,h.Z)(w,c,l,!1,null,null,null),f=p.exports,g=s(430),m=s(3729),T=s(3822),v={components:{Navbar:n.Z,FollowingsBar:a.Z,TweetsSection:o.Z,NewTweet:f,ModalNewTweet:g.Z},data(){return{tweets:[],isProcessing:!1,offset:0,loadMoreTrigger:"tweets",loadToEnd:!1}},methods:{async fetchTweets(){try{const e=this.offset;this.offset=this.offset+10;const t=await m.Z.getTweets({offset:e});if(200!==t.status)throw new Error;const s=t.data;if("loadToEnd"===s)return void(this.loadToEnd=!0);s.forEach((e=>{this.tweets.push(e)}))}catch(e){console.warn(e),d.F.fire({icon:"error",title:"暫時無法讀取 Tweets，請稍後再試",timer:2e3})}},async afterCreateTweet(e){try{this.isProcessing=!0;const{UserId:t,description:s}=e,r={UserId:t,description:s},i=await m.Z.postTweet({formData:r}),n=i.data;if("success"!==n.status)throw new Error(n.message);this.tweets.unshift({Likes:[],Replies:[],User:{account:this.currentUser.account,avatar:this.currentUser.avatar,banner:this.currentUser.banner,id:this.currentUser.id,introduction:this.currentUser.introduction,name:this.currentUser.name,role:this.currentUser.role},UserId:this.currentUser.id,createdAt:Date.now(),description:s,id:n.tweetId,likesLength:0,repliesLength:0,updatedAt:Date.now()}),d.F.fire({icon:"success",title:"推文發送成功"}),this.isProcessing=!1}catch(t){this.isProcessing=!1,console.warn(t)}},afterPostNewTweet(e){this.tweets.unshift({Likes:[],Replies:[],User:{account:this.currentUser.account,avatar:this.currentUser.avatar,banner:this.currentUser.banner,id:this.currentUser.id,introduction:this.currentUser.introduction,name:this.currentUser.name,role:this.currentUser.role},UserId:this.currentUser.id,createdAt:Date.now(),description:e.description,id:e.tweetId,likesLength:0,repliesLength:0,updatedAt:Date.now()}),d.F.fire({icon:"success",title:"推文發送成功"})},loadMore(e){this.fetchTweets()}},computed:{...(0,T.rn)(["currentUser","isAuthenticated"])},created(){this.fetchTweets()}},U=v,C=(0,h.Z)(U,r,i,!1,null,null,null),k=C.exports}}]);
//# sourceMappingURL=501.5fd692c0.js.map